<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <title>GNS Admin - Dashboard</title>
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --border: #30363d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #2ea043;
            --accent-red: #da3633;
            --accent-yellow: #d29922;
            --btn-primary: #238636;
            --btn-secondary: #30363d;
            --sidebar-width: 280px;
            --topbar-height: 60px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;}
        body {
            background: var(--bg-dark); color: var(--text-primary); min-height: 100vh;
            display: flex; flex-direction: column;
        }
        .topbar {
            background: var(--bg-card); height: var(--topbar-height); display: flex; align-items: center;
            padding: 0 16px; position: fixed; top: 0; left: var(--sidebar-width); right: 0; z-index: 100;
            border-bottom: 1px solid var(--border);
        }
        .topbar-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .tabs { display: flex; gap: 8px; }
        .tab {
            padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s;
        }
        .tab:hover { background: var(--btn-secondary);}
        .tab.active { background: rgba(88,166,255,0.15); color: var(--accent-blue);}
        .user-menu { display: flex; align-items: center; gap: 12px; flex-shrink: 0;}
        .sign-out-btn {
            padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border);
            background: rgba(218,54,51,0.1); border-color: rgba(238,45,41,0.1) ;
            color: var(--text-primary); cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 6px; transition: all 0.2s;
        }
        .sidebar {
            width: var(--sidebar-width); background: var(--bg-card); height: 100vh; position: fixed; top: 0; left: 0;
            transition: transform .3s; z-index: 90; overflow-y: auto; border-right: 1px solid var(--border);
        }
        .sidebar-content { padding: 20px; padding-top: calc(20px + var(--topbar-height)); }
        .force-info { margin-bottom: 24px; }
        .force-header { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 16px;}
        .force-logo {
            width: 60px; height: 60px; border-radius: 8px; background: var(--btn-secondary);
            display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer;
            position: relative; overflow: hidden; flex-shrink: 0; transition: all 0.2s;
        }
        .force-logo:hover { transform: scale(1.05); box-shadow: 0 0 0 2px var(--accent-blue);}
        .force-logo img { width: 100%; height: 100%; object-fit: cover;}
        .force-logo-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); position: relative;}
        .edit-icon {
            position: absolute; top: 4px; right: 4px; background: transparent; border-radius: 50%;
            width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; opacity: 0; transition: opacity 0.2s;
        }
        .force-logo:hover .edit-icon { opacity: 1;}
        .force-name-container { flex: 1;}
        .force-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; display: flex; align-items: center; gap: 8px;}
        .force-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;}
        .stat-card {
            background: rgba(48,54,61,0.3); border-radius: 6px; padding: 12px; cursor: pointer; transition: background .2s;
        }
        .stat-card:hover { background: rgba(48,54,61,0.5);}
        .stat-value { font-size: 24px; font-weight: 600; margin-bottom: 4px;}
        .stat-label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase;}
        .force-details { margin-top: 16px;}
        .detail-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);}
        .detail-label { color: var(--text-secondary);}
        .detail-value { font-weight: 500; text-align: right; max-width: 60%; word-break: break-word;}
        .edit-details-btn {
            width: 100%; padding: 8px; background: none; border: 1px dashed var(--border); color: var(--text-secondary); border-radius: 4px; cursor: pointer; margin-top: 12px; font-size: 14px;
        }
        .edit-details-btn:hover { background: var(--btn-secondary);}
        .main-content {
            flex: 1; margin-left: var(--sidebar-width); padding: 24px; margin-top: var(--topbar-height); transition: margin-left .3s;
        }
        .section {
            margin-bottom: 40px;
        }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;}
        .section-title { font-size: 24px; font-weight: 500;}
        .card {
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 16px; margin-bottom: 16px;
        }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;}
        .card-title { font-size: 18px; font-weight: 500; display: flex; align-items: center; gap: 8px;}
        .card-actions { display: flex; gap: 8px;}
        .btn {
            padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border); background: var(--btn-secondary);
            color: var(--text-primary); cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 4px; transition: all 0.2s;
        }
        .btn:hover { background: #383e47;}
        .btn-primary { background: var(--btn-primary); border-color: var(--btn-primary);}
        .btn-primary:hover { background: #2ea043;}
        .btn-danger { background: var(--btn-secondary); border-color: var(--border);}
        .btn-danger:hover { background: rgba(218,54,51,0.1); color: var(--accent-red);}
        .btn-secondary { background: var(--btn-secondary); border-color: var(--border);}
        .btn-secondary:hover { background: #383e47;}
        .card-content { color: var(--text-secondary); font-size: 14px; line-height: 1.5;}
        .card-content p { margin-bottom: 8px;}
        .status { display: inline-flex; align-items: center; gap: 4px;}
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block;}
        .status-green { background: var(--accent-green);}
        .status-yellow { background: var(--accent-yellow);}
        .status-red { background: var(--accent-red);}
        /* Ship status blue for under construction */
        .status-blue { background: var(--accent-blue);}
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 24px;}
        .hidden { display: none;}
        .form-group { margin-bottom: 16px;}
        .form-label { display: block; margin-bottom: 8px; font-size: 14px;}
        .form-input {
            width: 100%; padding: 8px 12px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px;
            color: var(--text-primary); font-size: 14px;
        }
        .form-row { display: flex; gap: 16px;}
        .form-col { flex: 1;}
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 8px;}
        .checkbox-item { display: flex; align-items: center; gap: 4px;}
        .checkbox-item input { margin-right: 4px;}
        .file-input-wrapper { position: relative; overflow: hidden; display: inline-block;}
        .file-input-wrapper input[type=file] {
            position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer;
        }
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        .modal.show { opacity: 1; visibility: visible;}
        .modal-content {
            background: var(--bg-card); border-radius: 8px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto;
            border: 1px solid var(--border); transform: translateY(-20px); transition: transform 0.3s;
        }
        .modal.show .modal-content { transform: translateY(0);}
        .modal-header {
            padding: 16px 24px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-title { font-size: 20px; font-weight: 500;}
        .modal-close {
            background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer; width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;
        }
        .modal-close:hover { background: var(--btn-secondary); color: var(--text-primary);}
        .modal-body { padding: 24px;}
        .modal-footer {
            padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px;
        }
        .base-list, .ship-list {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px; margin-top: 20px;
        }
        .base-card, .ship-card {
            background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 16px; position: relative;
            transition: transform .2s;
        }
        .base-card:hover, .ship-card:hover {
            transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .base-card-header, .ship-card-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
        }
        .base-name, .ship-name { font-size: 18px; font-weight: 500; color: var(--accent-blue);}
        .base-actions, .ship-actions { display: flex; gap: 8px;}
        .base-details, .ship-details { margin-top: 12px;}
        .base-detail, .ship-detail {
            display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(48,54,61,0.5);
        }
        .base-detail:last-child, .ship-detail:last-child { border-bottom: none;}
        .base-detail-label, .ship-detail-label { color: var(--text-secondary);}
        .base-detail-value, .ship-detail-value { font-weight: 500;}
        .add-base-btn, .add-ship-btn, .design-ship-btn {
            background: var(--btn-primary); border: none; color: white; padding: 8px 16px; border-radius: 6px;
            cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 6px;
            transition: background 0.2s;
        }
        .add-base-btn:hover, .add-ship-btn:hover { background: #2ea043;}
        .design-ship-btn {
            background: var(--btn-secondary); text-decoration: none; display: inline-flex; align-items: center; justify-content: center;
        }
        .design-ship-btn:hover { background: #383e47;}
        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-secondary); grid-column: 1 / -1;}
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5;}
        .ship-class-badge {
            display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;
            background: rgba(88,166,255,0.15); color: var(--accent-blue);
        }
        .section-buttons { display: flex; gap: 12px;}
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%);}
            .sidebar.active { transform: translateX(0);}
            .main-content, .topbar { margin-left: 0;}
            .topbar { left: 0;}
        }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr;}
            .form-row { flex-direction: column; gap: 16px;}
            .container { padding: 16px;}
            .force-header { flex-direction: column; align-items: center; text-align: center;}
            .force-name-container { text-align: center;}
            .topbar { padding: 0 12px;}
            .user-menu { gap: 8px;}
            .sidebar-content { padding-top: 20px;}
            .tabs { flex-wrap: wrap;}
            .base-list, .ship-list { grid-template-columns: 1fr;}
            .section-buttons { flex-direction: column; width: 100%;}
            .add-ship-btn, .design-ship-btn { width: 100%; justify-content: center;}
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="force-info">
                <div class="force-header">
                    <div class="force-logo" id="force-logo">
                        <div class="force-logo-placeholder">
                            ðŸ‡ºðŸ‡¸
                            <div class="edit-icon">
                                <span class="material-symbols-outlined">edit</span>
                            </div>
                        </div>
                        <input type="file" id="logo-upload" class="hidden" accept="image/*">
                    </div>
                    <div class="force-name-container">
                        <h2 class="force-name">United States Navy</h2>
                    </div>
                </div>
                <div class="force-stats">
                    <div class="stat-card" data-stat="ships">
                        <div class="stat-value" id="ships-count">0</div>
                        <div class="stat-label">Ships</div>
                    </div>
                    <div class="stat-card" data-stat="fleets">
                        <div class="stat-value" id="fleets-count">0</div>
                        <div class="stat-label">Fleets</div>
                    </div>
                </div>
                <div class="force-details">
                    <div class="detail-item">
                        <span class="detail-label">Commander</span>
                        <span class="detail-value" id="commander-value">Adm. Michael Gilday</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Established</span>
                        <span class="detail-value" id="established-value">1775</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Headquarters</span>
                        <span class="detail-value" id="headquarters-value">Pentagon, VA</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Motto</span>
                        <span class="detail-value" id="motto-value">"Non sibi sed patriae"</span>
                    </div>
                    <button class="edit-details-btn" id="edit-details-btn">Edit Force Details</button>
                </div>
            </div>
        </div>
    </aside>
    <!-- Topbar -->
    <header class="topbar">
        <div class="topbar-content">
            <div class="tabs">
                <div class="tab active" data-tab="ships">Ships</div>
                <div class="tab" data-tab="bases">Bases</div>
                <div class="tab" data-tab="fleets">Fleets</div>
            </div>
            <div class="user-menu">
                <button class="sign-out-btn">
                    <span></span> Sign Out
                </button>
            </div>
        </div>
    </header>
    <!-- Main Content -->
    <main class="main-content">
        <!-- Ships Section -->
        <div class="section" id="ships-section">
            <div class="section-header">
                <h2 class="section-title">Ships</h2>
                <div class="section-buttons">
                    <a href="shipDesigner.html" target="_blank" class="design-ship-btn">
                        <span></span> Design Ships
                    </a>
                    <button class="add-ship-btn" id="add-ship-btn">
                        <span>+</span> Add Ship
                    </button>
                </div>
            </div>
            <div class="ship-list" id="ship-list">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading ships...</p>
                </div>
            </div>
        </div>
        
        <!-- Bases Section -->
        <div class="section" id="bases-section">
            <div class="section-header">
                <h2 class="section-title">Bases</h2>
                <button class="add-base-btn" id="add-base-btn">
                    <span>+</span> Add Base
                </button>
            </div>
            <div class="base-list" id="base-list">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading bases...</p>
                </div>
            </div>
        </div>
        
        <!-- Fleets Section -->
        <div class="section" id="fleets-section">
            <div class="section-header">
                <h2 class="section-title">Fleets</h2>
            </div>
            <div class="grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Carrier Strike Group 12</h3>
                    </div>
                    <div class="card-content">
                        <p>Base: Norfolk Naval Station</p>
                        <p>Composition:</p>
                        <p>â€¢ CVN-78 USS Gerald R. Ford (Carrier)</p>
                        <p>â€¢ DDG-116 USS Zumwalt (Destroyer)</p>
                        <p>â€¢ SSN-785 USS Indiana (Submarine)</p>
                        <p>+ 5 more vessels</p>
                        <p>Status: <span class="status"><span class="status-dot status-green"></span> Deployed - Mediterranean</span></p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Pacific Submarine Fleet</h3>
                    </div>
                    <div class="card-content">
                        <p>Base: Pearl Harbor</p>
                        <p>Composition:</p>
                        <p>â€¢ 12 Attack Submarines</p>
                        <p>â€¢ 3 Ballistic Missile Submarines</p>
                        <p>Status: <span class="status"><span class="status-dot status-green"></span> Operational</span></p>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- Edit Force Details Modal -->
    <div class="modal" id="edit-force-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Force Details</h3>
                <button class="modal-close" id="close-force-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="edit-force-name">Force Name</label>
                    <input type="text" id="edit-force-name" class="form-input" placeholder="Enter force name">
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="edit-ships">Ships</label>
                            <input type="text" id="edit-ships" class="form-input" placeholder="Number of ships">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="edit-aircraft">Aircraft</label>
                            <input type="text" id="edit-aircraft" class="form-input" placeholder="Number of aircraft">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="edit-fleets">Fleets</label>
                            <input type="text" id="edit-fleets" class="form-input" placeholder="Number of fleets">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="edit-personnel">Personnel</label>
                            <input type="text" id="edit-personnel" class="form-input" placeholder="Number of personnel">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-commander">Commander</label>
                    <input type="text" id="edit-commander" class="form-input" placeholder="Commander name">
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="edit-established">Established</label>
                            <input type="text" id="edit-established" class="form-input" placeholder="Year established">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="edit-headquarters">Headquarters</label>
                            <input type="text" id="edit-headquarters" class="form-input" placeholder="Headquarters location">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-motto">Motto</label>
                    <input type="text" id="edit-motto" class="form-input" placeholder="Force motto">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-force-details">Cancel</button>
                <button class="btn btn-primary" id="save-force-details">Save Changes</button>
            </div>
        </div>
    </div>
    <!-- Add/Edit Base Modal -->
    <div class="modal" id="base-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="base-modal-title">Add New Base</h3>
                <button class="modal-close" id="close-base-modal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="base-id">
                <div class="form-group">
                    <label class="form-label" for="base-name">Base Name</label>
                    <input type="text" id="base-name" class="form-input" placeholder="Enter base name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="base-location">Location</label>
                    <input type="text" id="base-location" class="form-input" placeholder="Enter location">
                </div>
                <div class="form-group">
                    <label class="form-label" for="base-capacity">Capacity</label>
                    <input type="text" id="base-capacity" class="form-input" placeholder="Enter capacity (e.g. 10,000 personnel)">
                </div>
                <div class="form-group">
                    <label class="form-label" for="base-status">Status</label>
                    <select id="base-status" class="form-input">
                        <option value="operational">Operational</option>
                        <option value="limited">Limited Operations</option>
                        <option value="under-construction">Under Construction</option>
                        <option value="decommissioned">Decommissioned</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-base">Cancel</button>
                <button class="btn btn-primary" id="save-base">Save Base</button>
            </div>
        </div>
    </div>
    <!-- Add/Edit Ship Modal -->
    <div class="modal" id="ship-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="ship-modal-title">Add New Ship</h3>
                <button class="modal-close" id="close-ship-modal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="ship-id">
                <div class="form-group">
                    <label class="form-label" for="ship-name">Ship Name</label>
                    <input type="text" id="ship-name" class="form-input" placeholder="Enter ship name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="ship-class">Class</label>
                    <select id="ship-class" class="form-input">
                        <option value="Aircraft Carrier">Aircraft Carrier</option>
                        <option value="Destroyer">Destroyer</option>
                        <option value="Cruiser">Cruiser</option>
                        <option value="Submarine">Submarine</option>
                        <option value="Amphibious">Amphibious</option>
                        <option value="Frigate">Frigate</option>
                        <option value="Patrol">Patrol</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="ship-hull">Hull Number</label>
                    <input type="text" id="ship-hull" class="form-input" placeholder="Enter hull number (e.g. CVN-78)">
                </div>
                <div class="form-group">
                    <label class="form-label" for="ship-status">Status</label>
                    <select id="ship-status" class="form-input">
                        <option value="active">Active</option>
                        <option value="reserve">Reserve</option>
                        <option value="under-construction">Under Construction</option>
                        <option value="decommissioned">Decommissioned</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancel-ship">Cancel</button>
                <button class="btn btn-primary" id="save-ship">Save Ship</button>
            </div>
        </div>
    </div>
    <script>
const $ = s => document.querySelector(s), $$ = s => document.querySelectorAll(s);
class Modal {
    constructor(el, closeBtns = []) {
        this.el = el;
        closeBtns.forEach(b => b.onclick = () => this.close());
        el.onclick = e => e.target === el && this.close();
        document.addEventListener('keydown', e => e.key === 'Escape' && this.isOpen() && this.close());
    }
    open() { this.el.classList.add('show'); document.body.style.overflow = 'hidden'; }
    close() { this.el.classList.remove('show'); document.body.style.overflow = ''; }
    isOpen() { return this.el.classList.contains('show'); }
}
const StatusStrategy = {
    base: {
        operational: { cls: 'status-green', txt: 'Operational' },
        limited: { cls: 'status-yellow', txt: 'Limited Operations' },
        'under-construction': { cls: 'status-blue', txt: 'Under Construction' },
        decommissioned: { cls: 'status-red', txt: 'Decommissioned' }
    },
    ship: {
        active: { cls: 'status-green', txt: 'Active' },
        reserve: { cls: 'status-yellow', txt: 'Reserve' },
        'under-construction': { cls: 'status-blue', txt: 'Under Construction' },
        decommissioned: { cls: 'status-red', txt: 'Decommissioned' }
    },
    get(type, status) {
        return this[type][status] || this[type][Object.keys(this[type])[0]];
    }
};
const TemplateFactory = {
    base: b => {
        const s = StatusStrategy.get('base', b.status);
        return `
<div class="base-card" data-id="${b.id}">
    <div class="base-card-header">
        <h3 class="base-name">${b.name}</h3>
        <div class="base-actions">
            <button class="btn btn-edit">
                <span class="material-symbols-outlined">edit</span>
            </button>
            <button class="btn btn-danger">
                <span class="material-symbols-outlined">delete</span>
            </button>
        </div>
    </div>
    <div class="base-details">
        <div class="base-detail">
            <span class="base-detail-label">Location:</span>
            <span class="base-detail-value">${b.location}</span>
        </div>
        <div class="base-detail">
            <span class="base-detail-label">Capacity:</span>
            <span class="base-detail-value">${b.capacity}</span>
        </div>
        <div class="base-detail">
            <span class="base-detail-label">Status:</span>
            <span class="base-detail-value status"><span class="status-dot ${s.cls}"></span> ${s.txt}</span>
        </div>
    </div>
</div>`;
    },
    ship: s => {
        const st = StatusStrategy.get('ship', s.status);
        return `
<div class="ship-card" data-id="${s.id}">
    <div class="ship-card-header">
        <h3 class="ship-name">${s.name}</h3>
        <div class="ship-actions">
            <button class="btn btn-edit">
                <span class="material-symbols-outlined">edit</span>
            </button>
            <button class="btn btn-danger">
                <span class="material-symbols-outlined">delete</span>
            </button>
        </div>
    </div>
    <div class="ship-details">
        <div class="ship-detail">
            <span class="ship-detail-label">Class:</span>
            <span class="ship-detail-value"><span class="ship-class-badge">${s.class}</span></span>
        </div>
        <div class="ship-detail">
            <span class="ship-detail-label">Hull Number:</span>
            <span class="ship-detail-value">${s.hull}</span>
        </div>
        <div class="ship-detail">
            <span class="ship-detail-label">Status:</span>
            <span class="ship-detail-value status"><span class="status-dot ${st.cls}"></span> ${st.txt}</span>
        </div>
    </div>
</div>`;
    }
};
const ListRenderer = {
    render(type, list, container) {
        container.innerHTML = list.length
            ? list.map(TemplateFactory[type]).join('')
            : `<div class="empty-state">
                <div class="empty-state-icon">${type === 'base' ? 'âš“' : 'ðŸš¢'}</div>
                <h3>No Naval ${type === 'base' ? 'Bases' : 'Ships'}</h3>
                <p>Click "Add ${type[0].toUpperCase() + type.slice(1)}" to add your first ${type}</p>
            </div>`;
    }
};
class DataStore {
    constructor() {
        this._bases = [];
        this._ships = [];
        this._nextBaseId = 1;
        this._nextShipId = 1;
    }
    
    bases() { return this._bases; }
    ships() { return this._ships; }
    
    _update(list, obj) {
        const index = list.findIndex(x => x.id === obj.id);
        if (index !== -1) {
            list[index] = obj;
        }
    }
    
    _remove(list, id) {
        return list.filter(x => x.id !== id);
    }
    
    addBase(b) {
        const newBase = { ...b, id: this._nextBaseId++ };
        this._bases.push(newBase);
        return newBase;
    }
    
    updateBase(b) {
        this._update(this._bases, b);
    }
    
    removeBase(id) {
        this._bases = this._remove(this._bases, id);
    }
    
    addShip(s) {
        const newShip = { ...s, id: this._nextShipId++ };
        this._ships.push(newShip);
        return newShip;
    }
    
    updateShip(s) {
        this._update(this._ships, s);
    }
    
    removeShip(id) {
        this._ships = this._remove(this._ships, id);
    }
    
    async loadData() {
        try {
            const [basesResponse, shipsResponse] = await Promise.all([
                fetch('bases.json'),
                fetch('ships.json')
            ]);
            
            if (basesResponse.ok) {
                this._bases = await basesResponse.json();
                this._nextBaseId = Math.max(0, ...this._bases.map(b => b.id)) + 1;
            }
            
            if (shipsResponse.ok) {
                this._ships = await shipsResponse.json();
                this._nextShipId = Math.max(0, ...this._ships.map(s => s.id)) + 1;
            }
            
            return true;
        } catch (error) {
            console.error('Error loading data:', error);
            return false;
        }
    }
    /*
    fileReader = new FileReader();
    fileInput = $('#data-upload');
    async readCSV (e) {
        this.fileReader.onload(() => console.log(this.fileReader.result));
        this.fileInput.setAttribute('disabled', !0);
        const t = e.target.files[0];
        this.fileReader.readAsText(t);
    }
    @todo - test this + actually integrate
    */
}
const store = new DataStore();
const editForceModal = new Modal($('#edit-force-modal'), [$('#close-force-modal'), $('#cancel-force-details')]);
const baseModal = new Modal($('#base-modal'), [$('#close-base-modal'), $('#cancel-base')]);
const shipModal = new Modal($('#ship-modal'), [$('#close-ship-modal'), $('#cancel-ship')]);
/*
<input id="data-upload" type="file" accept=".csv"/>
$("data-upload").addEventListener("change", readCSV.bind(store));
*/
$('#force-logo').onclick = () => $('#logo-upload').click();
$('#logo-upload').onchange = function() {
    if (this.files[0]) {
        const r = new FileReader();
        r.onload = e => $('#force-logo').innerHTML = `<img src="${e.target.result}" alt="Force Logo">`;
        r.readAsDataURL(this.files[0]);
    }
};
$('#edit-details-btn').onclick = () => {
    $('#edit-force-name').value = $('.force-name').textContent.replace(/^ðŸ‡ºðŸ‡¸\s*/, '');
    ['ships','aircraft','fleets','personnel','commander','established','headquarters'].forEach(f => 
        $(`#edit-${f}`).value = $(`#${f}-count, #${f}-value`.split(', ').map(sel => $(sel)).find(el=>el)?.textContent)
    );
    $('#edit-motto').value = $('#motto-value').textContent.replace(/"/g,'');
    editForceModal.open();
};
$('#save-force-details').onclick = () => {
    $('.force-name').innerHTML = `ðŸ‡ºðŸ‡¸ ${$('#edit-force-name').value}`;
    ['ships','aircraft','fleets','personnel','commander','established','headquarters'].forEach(f => {
        const v = $(`#edit-${f}`).value;
        $(`#${f}-count, #${f}-value`.split(', ').map(sel => $(sel)).find(el=>el)).textContent = v;
    });
    $('#motto-value').textContent = `"${$('#edit-motto').value}"`;
    editForceModal.close();
};
$$('.tab').forEach(tab => tab.onclick = () => {
    $$('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    
    // Scroll to the selected section
    const sectionId = tab.dataset.tab;
    const section = $(`#${sectionId}-section`);
    if (section) {
        section.scrollIntoView({ behavior: 'smooth' });
    }
    
    updateStatsFromContent();
});
const renderShips = () => ListRenderer.render('ship', store.ships(), $('#ship-list'));
$('#ship-list').onclick = e => {
    const card = e.target.closest('.ship-card');
    if (!card) return;
    
    const id = +card.dataset.id;
    if (e.target.classList.contains('btn-edit')) {
        const s = store.ships().find(x => x.id === id);
        ['id','name','class','hull','status'].forEach(f => $(`#ship-${f}`).value = s[f] || '');
        $('#ship-modal-title').textContent = 'Edit Ship';
        shipModal.open();
        return;
    }
    
    if (e.target.classList.contains('btn-danger') && confirm('Delete ship?')) {
        store.removeShip(id);
        renderShips();
        updateStatsFromContent();
    }
};
$('#add-ship-btn').onclick = () => {
    ['ship-id','ship-name','ship-hull'].forEach(f => $(`#${f}`).value = '');
    $('#ship-class').value = 'Aircraft Carrier';
    $('#ship-status').value = 'active';
    $('#ship-modal-title').textContent = 'Add Ship';
    shipModal.open();
};
$('#save-ship').onclick = () => {
    const s = {
        id: $('#ship-id').value ? +$('#ship-id').value : null,
        name: $('#ship-name').value.trim(),
        class: $('#ship-class').value,
        hull: $('#ship-hull').value.trim(),
        status: $('#ship-status').value
    };
    
    if (!s.name || !s.hull) {
        alert('Fill all fields');
        return;
    }
    
    if (s.id) {
        store.updateShip(s);
    } else {
        store.addShip(s);
    }
    
    renderShips();
    shipModal.close();
    updateStatsFromContent();
};
const renderBases = () => ListRenderer.render('base', store.bases(), $('#base-list'));
$('#base-list').onclick = e => {
    const card = e.target.closest('.base-card');
    if (!card) return;
    
    const id = +card.dataset.id;
    if (e.target.classList.contains('btn-edit')) {
        const b = store.bases().find(x => x.id === id);
        ['id','name','location','capacity','status'].forEach(f => $(`#base-${f}`).value = b[f] || '');
        $('#base-modal-title').textContent = 'Edit Base';
        baseModal.open();
        return;
    }
    
    if (e.target.classList.contains('btn-danger') && confirm('Delete base?')) {
        store.removeBase(id);
        renderBases();
        updateStatsFromContent();
    }
};
$('#add-base-btn').onclick = () => {
    ['id','name','location','capacity'].forEach(f => $(`#base-${f}`).value = '');
    $('#base-status').value = 'operational';
    $('#base-modal-title').textContent = 'Add Base';
    baseModal.open();
};
$('#save-base').onclick = () => {
    const b = ['id','name','location','capacity','status'].reduce((o,f) => {
        o[f] = $(`#base-${f}`).value.trim();
        return o;
    }, {});
    
    if (!b.name || !b.location || !b.capacity) {
        alert('Fill all fields');
        return;
    }
    
    if (b.id) {
        store.updateBase(b);
    } else {
        store.addBase(b);
    }
    
    renderBases();
    baseModal.close();
    updateStatsFromContent();
};
const updateStatsFromContent = () => {
    const shipsCount = $('#ship-list').children.length;
    const actualShipsCount = $('#ship-list').querySelector('.empty-state') ? 0 : shipsCount;
    $('#ships-count').textContent = actualShipsCount;

    const fleetsContent = $('#fleets-section');
    let fleetsCount = 0;
    if (fleetsContent) {
        const fleetCards = fleetsContent.querySelectorAll('.grid > .card');
        fleetsCount = fleetCards.length;
    }
    $('#fleets-count').textContent = fleetsCount;
};
const initApp = async () => {
    const dataLoaded = await store.loadData();
    
    if (dataLoaded) {
        renderBases();
        renderShips();
        
        updateStatsFromContent();
    } else {
        $('#base-list').innerHTML = `<div class="empty-state">
            <h3>Error Loading Data</h3>
            <p>Failed to load bases and ships data.</p>
        </div>`;
        
        $('#ship-list').innerHTML = `<div class="empty-state">
            <h3>Error Loading Data</h3>
            <p>Failed to load bases and ships data.</p>
        </div>`;
    }
};
document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
